<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GT-Salat - مواقيت الصلاة والتقويم الإسلامي</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
    --primary-color: #1a5e63;
    --secondary-color: #4cd7d0;
    --accent-color: #2a9d8f;
    --dark-color: #0d3235;
    --light-color: #e0f2f1;
    --text-color: #333;
    --prayer-time-bg: rgba(255, 255, 255, 0.1);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-color) 100%);
    color: var(--light-color);
    min-height: 100vh;
    padding: 20px;
    line-height: 1.6;
}

.container { max-width: 1200px; margin: 0 auto; }

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
    margin-bottom: 30px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.logo { display: flex; align-items: center; gap: 15px; }
.logo i { font-size: 2.5rem; color: var(--secondary-color); }
.logo h1 { font-size: 2rem; font-weight: 700; }
.logo span { color: var(--secondary-color); }

.main-content { display: grid; grid-template-columns: 1fr 350px; gap: 30px; margin-bottom: 40px; }

.prayer-times {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.section-title { color: var(--secondary-color); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.2); font-size:1.5rem; }

.current-date { text-align: center; margin-bottom: 25px; background: var(--prayer-time-bg); padding: 15px; border-radius: 10px; }
.hijri-date { font-size:1.2rem; color: var(--secondary-color); margin-top:5px; }

.prayer-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px,1fr));
    gap:15px;
    margin-bottom:25px;
}

.prayer-card {
    background: var(--prayer-time-bg);
    border-radius: 10px;
    padding: 15px;
    text-align:center;
    transition: transform 0.3s;
}
.prayer-card.active { background: rgba(76,215,208,0.2); border:1px solid var(--secondary-color); }
.prayer-card:hover { transform: translateY(-5px); }
.prayer-name { font-size:1.2rem; margin-bottom:10px; color: var(--secondary-color); }
.prayer-time { font-size:1.4rem; font-weight:700; }

.countdown { text-align:center; margin-top:20px; padding:15px; background: var(--prayer-time-bg); border-radius:10px; }
.countdown-text { font-size:1.1rem; margin-bottom:10px; }
.countdown-time { font-size:1.8rem; color: var(--secondary-color); font-weight:700; }

.calendar-section {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
    border-radius:15px;
    padding:25px;
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    height:fit-content;
}

.calendar { background: var(--prayer-time-bg); border-radius:10px; overflow:hidden; }
.calendar-header { display:flex; justify-content:space-between; align-items:center; padding:15px; background: var(--accent-color); }
.calendar-header button { background:none; border:none; color:white; font-size:1.2rem; cursor:pointer; }
.calendar-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; padding:15px; }
.calendar-cell { text-align:center; padding:10px 5px; }
.calendar-cell.day-header { font-weight:700; color: var(--secondary-color); border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:15px; }
.calendar-cell.today { background: var(--secondary-color); color: var(--dark-color); border-radius:50%; width:35px; height:35px; display:flex; align-items:center; justify-content:center; margin:0 auto; }
.hijri-day { font-size:0.8rem; color: var(--secondary-color); margin-top:3px; }

.settings-panel {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
    border-radius:15px;
    padding:25px;
    box-shadow:0 8px 32px rgba(0,0,0,0.3);
    margin-bottom:30px;
}

.form-group { margin-bottom:25px; }
label { display:block; margin-bottom:10px; font-weight:500; color: var(--secondary-color); }
.location-settings { display:flex; gap:10px; }
input.form-control { flex:1; padding:12px 15px; border:none; border-radius:8px; background: rgba(255,255,255,0.12); color: var(--light-color); font-size:16px; }
input.form-control::placeholder { color: rgba(255,255,255,0.6); }
button.location-auto { padding:12px 18px; background: var(--accent-color); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:500; transition: background 0.3s; white-space:nowrap; }
button.location-auto:hover { background:#21867a; }
select.form-control { width:100%; padding:12px 15px; border:none; border-radius:8px; background: rgba(255,255,255,0.12); color: var(--light-color); font-size:16px; appearance:none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 12L2 6h12L8 12z'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 15px center; background-size:15px; }
select.form-control option { background: var(--primary-color); color: var(--light-color); }

.actions { display:flex; justify-content:flex-end; gap:10px; }
button { padding:12px 25px; border:none; border-radius:8px; cursor:pointer; font-weight:500; transition:all 0.3s; }
button.save { background: var(--secondary-color); color: var(--dark-color); }
button.save:hover { background:#3bc2bb; }
button.cancel { background: rgba(255,255,255,0.15); color: var(--light-color); }
button.cancel:hover { background: rgba(255,255,255,0.25); }

footer { text-align:center; padding:20px 0; margin-top:40px; border-top:1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); font-size:0.9rem; }

@media(max-width:900px) { .main-content { grid-template-columns:1fr; } .location-settings { flex-direction:column; } }
@media(max-width:600px) { .prayer-cards { grid-template-columns:repeat(2,1fr); } header { flex-direction:column; text-align:center; gap:15px; } .logo { justify-content:center; } }
</style>
</head>
<body>
<div class="container">
<header>
    <div class="logo">
        <i class="fas fa-mosque"></i>
        <h1>GT-<span>Salat</span></h1>
    </div>
    <div class="current-date">
        <div id="gregorian-date">جاري التحميل...</div>
        <div id="hijri-date" class="hijri-date">جاري التحميل...</div>
    </div>
</header>

<div class="main-content">
    <section class="prayer-times">
        <h2 class="section-title">مواقيت الصلاة</h2>
        <div class="prayer-cards">
            <div class="prayer-card"><div class="prayer-name">Fajr</div><div class="prayer-time">--:--</div></div>
            <div class="prayer-card"><div class="prayer-name">Sunrise</div><div class="prayer-time">--:--</div></div>
            <div class="prayer-card"><div class="prayer-name">Dhuhr</div><div class="prayer-time">--:--</div></div>
            <div class="prayer-card"><div class="prayer-name">Asr</div><div class="prayer-time">--:--</div></div>
            <div class="prayer-card"><div class="prayer-name">Maghrib</div><div class="prayer-time">--:--</div></div>
            <div class="prayer-card"><div class="prayer-name">Isha</div><div class="prayer-time">--:--</div></div>
        </div>
        <div class="countdown">
            <div class="countdown-text">جاري التحميل...</div>
            <div class="countdown-time">00:00:00</div>
        </div>
    </section>

    <section class="calendar-section">
        <h2 class="section-title">التقويم الهجري</h2>
        <div class="calendar" id="calendar">
            <!-- سيتم ملء التقويم ديناميكيًا -->
        </div>
    </section>
</div>

<section class="settings-panel">
<h2 class="section-title">إعدادات المواقيت</h2>
<div class="form-group">
<label>الموقع الجغرافي</label>
<div class="location-settings">
    <input type="text" class="form-control" id="prayer-location" placeholder="اسم المدينة">
    <button class="location-auto" id="prayer-location-auto"><i class="fas fa-location-arrow"></i> التحديد التلقائي</button>
</div>
</div>

<div class="form-group">
<label>طريقة الحساب</label>
<select class="form-control" id="prayer-method">
    <option value="2">المسجد الحرام - مكة</option>
    <option value="3">جامعة العلوم الإسلامية - Karachi</option>
    <option value="4">Egypt General Authority</option>
    <option value="5">University of Islamic Sciences, Karachi</option>
</select>
</div>

<div class="actions">
    <button class="save" id="save-settings">حفظ الإعدادات</button>
    <button class="cancel" id="cancel-settings">إلغاء</button>
</div>
</section>

<footer>GT-Salat by gnutux &copy; 2025</footer>
</div>

<script>
const prayerCards = document.querySelectorAll('.prayer-card');
const countdownText = document.querySelector('.countdown-text');
const countdownTime = document.querySelector('.countdown-time');
const gregorianDateEl = document.getElementById('gregorian-date');
const hijriDateEl = document.getElementById('hijri-date');

function getUserLocation(callback) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            callback({lat: pos.coords.latitude, lng: pos.coords.longitude});
        }, err => {
            alert("تعذر الحصول على موقعك، سيتم استخدام مكة المكرمة.");
            callback({lat:21.3891,lng:39.8579});
        });
    } else {
        alert("المتصفح لا يدعم تحديد الموقع.");
        callback({lat:21.3891,lng:39.8579});
    }
}

function fetchPrayerTimes(lat, lng, method=2) {
    const timestamp = Math.floor(new Date().getTime()/1000);
    fetch(`https://api.aladhan.com/v1/timings/${timestamp}?latitude=${lat}&longitude=${lng}&method=${method}`)
    .then(res => res.json())
    .then(data => {
        const timings = data.data.timings;
        prayerCards.forEach(card => {
            const name = card.querySelector('.prayer-name').textContent;
            card.querySelector('.prayer-time').textContent = timings[name] || '--:--';
        });
        gregorianDateEl.textContent = data.data.date.gregorian.date;
        hijriDateEl.textContent = data.data.date.hijri.date;
        startCountdown(timings);
    }).catch(err => console.error("خطأ في جلب أوقات الصلاة:", err));
}

function startCountdown(timings) {
    function updateCountdown() {
        const now = new Date();
        let nextPrayer = null;
        let minDiff = Infinity;
        Object.keys(timings).forEach(name => {
            let [h,m] = timings[name].split(':').map(Number);
            let t = new Date(); t.setHours(h); t.setMinutes(m); t.setSeconds(0);
            let diff = t-now;
            if(diff>0 && diff<minDiff){minDiff=diff; nextPrayer=name;}
        });
        if(nextPrayer){
            let h = Math.floor(minDiff/3600000);
            let m = Math.floor((minDiff%3600000)/60000);
            let s = Math.floor((minDiff%60000)/1000);
            countdownText.textContent = `متبقي حتى صلاة ${nextPrayer}`;
            countdownTime.textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(h===0 && m===0 && s===0){
                alert(`حان وقت صلاة ${nextPrayer}`);
                new Audio('azan.mp3').play();
            }
        }
    }
    updateCountdown();
    setInterval(updateCountdown,1000);
}

// التعامل مع الإعدادات
document.getElementById('prayer-location-auto').addEventListener('click',()=>{
    getUserLocation(coords=>{
        fetchPrayerTimes(coords.lat, coords.lng, document.getElementById('prayer-method').value);
    });
});

document.getElementById('save-settings').addEventListener('click',()=>{
    getUserLocation(coords=>{
        fetchPrayerTimes(coords.lat, coords.lng, document.getElementById('prayer-method').value);
        alert("تم حفظ الإعدادات!");
    });
});

document.getElementById('cancel-settings').addEventListener('click',()=>{
    alert("تم إلغاء التغييرات");
});

// تحميل البيانات أول مرة
getUserLocation(coords=>{
    fetchPrayerTimes(coords.lat, coords.lng, document.getElementById('prayer-method').value);
});
</script>
</body>
</html>
